<!doctype html>
<html lang="eng">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<title>yourMood</title>

		<!-- css -->
		<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
		<link rel="stylesheet" href="style.css">
		<link href='http://fonts.googleapis.com/css?family=Dancing+Script' rel='stylesheet' type='text/css'>

		<!-- Load the Paper.js library -->
		<script type="text/javascript" src="js/paper.js"></script>

		<!-- Javascript -->
		<script type="text/javascript" src="Myo.js"></script>
		<script src='myo.experimental.js'></script>
		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
		<script type="text/javascript" src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
	</head>

	<body>
		<div class="header row">
			<h1 class="col-lg-12">Always There</h1>
			<h2 class="col-lg-12">~ You are Never Alone</h2>
		</div>
		<div class="info_column">
			<ul class="data col-sm-6">
				<li id="varX"></li>
				<li id="varY"></li>
				<li id="varZ"></li>
				<li id="varW"></li>

				<li id="pitch"></li>
				<li id="yaw"></li>

				<li id="roll2"></li>
				<li id="pitch2"></li>
				<li id="yaw2"></li>

				<li id="init_P"></li>
				<li id="init_Y"></li>

				<li id="diff_P"></li>
				<li id="diff_Y"></li>
			</ul>
			<ul class="result col-sm-6">
				<div class="output">
					<h2>Your Action:</h2>
					<li id="pose"></li>
				</div>
				<div class="inputFromOther">
					<h2>Response:</h2>
					<li id="response"></li>
				</div>
				
			</ul>
		</div>

		<canvas id="myCanvas" width="100" height="100"></canvas>

	</body>

	<!-- Define inlined PaperScript associate it with myCanvas -->
	<script type="text/paperscript" canvas="myCanvas">
		// Create a Paper.js Path to draw a line into it:
		var path = new Path();
		// Give the stroke a color
		path.strokeColor = 'red';
		var start = new Point(100, 100);
		// Move to start and draw a line from there
		path.moveTo(start);
		// Note the plus operator on Point objects.
		// PaperScript does that for us, and much more!
		path.lineTo(start + [ 100, -50 ]);
	</script>

	<script>

		var init_pitch;
		var init_yaw;
		document.getElementById("init_P").innerHTML = "init pitch: " + init_pitch;
		document.getElementById("init_Y").innerHTML = "init yaw: " + init_yaw;

		var myMyo = Myo.create();
		
		//myMyo.zeroOrientation();
		myMyo.on('orientation', function(data){

			document.getElementById("varX").innerHTML = "val x: " + data.x;
			document.getElementById("varY").innerHTML = "val y: " + data.y;
			document.getElementById("varZ").innerHTML = "val z: " + data.z;
			document.getElementById("varW").innerHTML = "val w: " + data.w;


			var pitch = Math.asin(2.0 * (data.w * data.y - data.z * data.x))*100;
			var yaw = Math.atan2(2.0 * (data.w * data.z + data.x * data.y),
                       1.0 - 2.0 * (data.y * data.y + data.z * data.z))*100;

			myMyo.on('fist', function(edge){
				if(!edge) return;
				alert('Initialising2');
				init_pitch = pitch*100;
				init_yaw = yaw*100;
				document.getElementById("init_P").innerHTML = "init pitch: " + init_pitch;
				document.getElementById("init_Y").innerHTML = "init yaw: " + init_yaw;
				document.getElementById('pose').innerHTML = "Initiating Sequence";
				return;
			})

			document.getElementById("pitch").innerHTML = "pitch: " + pitch;
			document.getElementById("yaw").innerHTML = "yaw: " + yaw;



			var roll = Math.atan2(2.0 * (data.w * data.x + data.y * data.z),
                           1.0 - 2.0 * (data.x * data.x + data.y * data.y));
      var pitch = Math.asin(2.0 * (data.w * data.y - data.z * data.x));
      var yaw = Math.atan2(2.0 * (data.w * data.z + data.x * data.y),
                        1.0 - 2.0 * (data.y * data.y + data.z * data.z));
      
      // Convert the floating point angles in radians to a scale from 0 to 360.
      var roll_w = (20*(roll + Math.PI)/(Math.PI * 2.0) * 18);
      var pitch_w = (20*(pitch + Math.PI/2.0)/Math.PI * 18);
      var yaw_w = (20*(yaw + Math.PI)/(Math.PI * 2.0) * 18);

      document.getElementById("roll2").innerHTML = "roll: " + roll_w;
      document.getElementById("pitch2").innerHTML = "pitch: " + pitch_w;
			document.getElementById("yaw2").innerHTML = "yaw: " + yaw_w;

			var yawDiff = function(){
				return init_yaw - yaw*100;
			}
			var pitchDiff = function(){
				return (Math.abs(init_pitch) - Math.abs(pitch*100));
			}


			document.getElementById("diff_Y").innerHTML = "diff in yaw: " + yawDiff();
			document.getElementById("diff_P").innerHTML = "diff in pitch: " + pitchDiff();

			//hug determiner via delta yaw
			if(yawDiff() < -70){
				console.log("hug");
				document.getElementById('pose').innerHTML = "hug";
			}
			if(yawDiff() < -140){
				console.log("tight hug");
				document.getElementById('pose').innerHTML = "tight hug";
			}

			//hug + rub determiner via delta pitch
			if(yawDiff() < -70 && pitchDiff() <-15){
				console.log("hug + short stroke rub");
				document.getElementById('pose').innerHTML = "hug + short stroke rub";
			}
			if(yawDiff() < -70 && pitchDiff() <-30){
				console.log("hug + Long stroke rub");
				document.getElementById('pose').innerHTML = "hug + Long stroke rub";
			}

			if(yawDiff() > 0 && pitchDiff() > 0){
				document.getElementById('pose').innerHTML = "none";
			}

			var responseText = function(){
				var options = ["Amazing", "Excellent", "Spot On", "Stellar", 
				"Nearly There", "A Tad Bit More", "I feel better"];
				var choice = Math.random()*options.length;
				document.getElementById("response").innerHTML = options[parseInt(choice)];
			}
		});
	</script>
</html>


